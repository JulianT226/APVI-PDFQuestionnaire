{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <form method="POST" id="pdfForm">
            {{ form.csrf_token }}

            <!-- State Selection Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">2</div>
                    <h3>State Selection</h3>
                </div>
                <div class="section-content">
                    <div class="mb-4">
                        <label class="form-label">{{ form.state.label.text }}<span style="color: red">*</span></label>
                        {{ form.state(class="form-select") }}
                        {% if form.state.errors %}
                            {% for error in form.state.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Personal Information Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">3</div>
                    <h3>Personal Information</h3>
                </div>
                <div class="section-content">
                    <div class="mb-3">
                        <label class="form-label">Full Name<span style="color: red">*</span></label>
                        <div class="row g-3">
                            <div class="col-md-4">
                                {{ form.first_name(class="form-control", placeholder="First name") }}
                                {% if form.first_name.errors %}
                                    {% for error in form.first_name.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <div class="col-md-4">
                                {{ form.middle_name(class="form-control", placeholder="Middle name") }}
                                {% if form.middle_name.errors %}
                                    {% for error in form.middle_name.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <div class="col-md-4">
                                {{ form.last_name(class="form-control", placeholder="Last name") }}
                                {% if form.last_name.errors %}
                                    {% for error in form.last_name.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label" for="{{ form.dob.id }}">{{ form.dob.label.text }}<span style="color: red">*</span></label>
                            {{ form.dob(class="form-control", type="date") }}
                            {% if form.dob.errors %}
                                {% for error in form.dob.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="{{ form.birth_place.id }}">{{ form.birth_place.label.text }}<span style="color: red">*</span></label>
                            {{ form.birth_place(class="form-control", placeholder="Enter country of birth, e.g. 'American'") }}
                            {% if form.birth_place.errors %}
                                {% for error in form.birth_place.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="{{ form.present_nationality.id }}">{{ form.present_nationality.label.text }}<span style="color: red">*</span></label>
                        {{ form.present_nationality(class="form-control", placeholder="Enter current nationality") }}
                        {% if form.present_nationality.errors %}
                            {% for error in form.present_nationality.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    
                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            {{ form.has_prev_nationality.label(class="form-label") }}<span style="color: red">*</span>
                            <div class="radio-card-group">
                                {% for subfield in form.has_prev_nationality %}
                                <div class="radio-card">
                                    <input type="radio" id="{{ subfield.id }}" name="{{ subfield.name }}" value="{{ subfield.data }}" {% if subfield.checked %}checked{% endif %} required onclick="togglePrevNationality({{ 'true' if subfield.data == 'Yes' else 'false' }})">
                                    <label for="{{ subfield.id }}">{{ subfield.label.text }}</label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <!-- Previous Nationality Field (hidden by default) -->
                    <div class="row g-6 mb-6" id="prevNationalityField" style="display: none;">
                        <div class="col-md-6">
                            <label class="form-label" for="{{ form.prev_nationality.id }}">{{ form.prev_nationality.label.text }}<span style="color: red">*</span></label>
                            {{ form.prev_nationality(class="form-control", placeholder="Enter previous nationality") }}
                            {% if form.prev_nationality.errors %}
                                {% for error in form.prev_nationality.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <script>
                function togglePrevNationality(show) {
                    const prevNationalityField = document.getElementById('prevNationalityField');
                    prevNationalityField.style.display = show ? 'block' : 'none';
                }
            </script>


            <!-- Personal Details Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">4</div>
                    <h3>Personal Details</h3>
                </div>
                <div class="section-content">
                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <label class="form-label">{{ form.sex.label.text }}<span style="color: red">*</span></label>
                            <div class="radio-card-group">
                                {% for subfield in form.sex %}
                                <div class="radio-card">
                                    <input type="radio" id="{{ subfield.id }}" name="{{ subfield.name }}" value="{{ subfield.data }}" {% if subfield.checked %}checked{% endif %} required>
                                    <label for="{{ subfield.id }}">{{ subfield.label.text }}</label>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="invalid-feedback d-block" style="display:none;"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">{{ form.marital_status.label.text }}<span style="color: red">*</span></label>
                            <div class="radio-card-group">
                                {% for subfield in form.marital_status %}
                                <div class="radio-card">
                                    <input type="radio" id="{{ subfield.id }}" name="{{ subfield.name }}" value="{{ subfield.data }}" {% if subfield.checked %}checked{% endif %} required>
                                    <label for="{{ subfield.id }}">{{ subfield.label.text }}</label>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="invalid-feedback d-block" style="display:none;"></div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">{{ form.religion.label.text }}<span style="color: red">*</span></label>
                            <div class="radio-card-group">
                                {% for subfield in form.religion %}
                                <div class="radio-card">
                                    <input type="radio" id="{{ subfield.id }}" name="{{ subfield.name }}" value="{{ subfield.data }}" {% if subfield.checked %}checked{% endif %} required>
                                    <label for="{{ subfield.id }}">{{ subfield.label.text }}</label>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="invalid-feedback d-block" style="display:none;"></div>
                        </div>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">
                                Job Title<span style="color: red">*</span>
                                <span 
                                    class="text-primary ms-1" 
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="right" 
                                    title='Ensure this matches the job title on your letter of invitation. If the applicant is a child, enter "Student"'>
                                    <i class="bi bi-info-circle"></i>
                                </span>
                            </label>
                            {{ form.profession(class="form-control", placeholder="Enter profession") }}
                            {% if form.profession.errors %}
                                {% for error in form.profession.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">
                                Highest Degree Earned<span style="color: red">*</span>
                                <span 
                                    class="text-primary ms-1" 
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="right" 
                                    title='If you do not have a degree, enter the number of years you have been working, e.g. "20 years"'>
                                    <i class="bi bi-info-circle"></i>
                                </span>
                            </label>
                            {{ form.qualification(class="form-control", placeholder="Enter qualification") }}
                            {% if form.qualification.errors %}
                                {% for error in form.qualification.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            
            <!-- Contact Information Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">5</div>
                    <h3>Contact Information</h3>
                </div>
                <div class="section-content">
                    <div class="mb-3">
                        <label class="form-label" for="{{ form.email.id }}">{{ form.email.label.text }}<span style="color: red">*</span></label>
                        {{ form.email(class="form-control", placeholder="Enter email address") }}
                        {% if form.email.errors %}
                            {% for error in form.email.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label" for="{{ form.phone_num.id }}">{{ form.phone_num.label.text }}<span style="color: red">*</span></label>
                        {{ form.phone_num(class="form-control", placeholder="Enter phone number") }}
                        {% if form.phone_num.errors %}
                            {% for error in form.phone_num.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <hr class="my-4">
                    
                    <div class="mb-4">
                        <label class="form-label"><strong>Home Address</strong></label>
                        <div class="mb-3">
                            <label class="form-label" for="{{ form.address_street.id }}">{{ form.address_street.label.text }}<span style="color: red">*</span></label>
                            {{ form.address_street(class="form-control", placeholder="Enter street address") }}
                            {% if form.address_street.errors %}
                                {% for error in form.address_street.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label" for="{{ form.address_city.id }}">{{ form.address_city.label.text }}<span style="color: red">*</span></label>
                                {{ form.address_city(class="form-control", placeholder="Enter city") }}
                                {% if form.address_city.errors %}
                                    {% for error in form.address_city.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="{{ form.address_state.id }}">{{ form.address_state.label.text }}<span style="color: red">*</span></label>
                                {{ form.address_state(class="form-control", placeholder="Enter state") }}
                                {% if form.address_state.errors %}
                                    {% for error in form.address_state.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employment Information Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">6</div>
                    <h3>Employment Information</h3>
                </div>
                <div class="section-content">
                    <div class="mb-3">
                        <label class="form-label">
                            Employer Address
                            <span 
                                class="text-primary ms-1" 
                                data-bs-toggle="tooltip" 
                                data-bs-placement="right" 
                                title="If the applicant is a child, leave blank and move to the next step.">
                                <i class="bi bi-info-circle"></i>
                            </span>
                        </label>
                        <div class="mb-3">
                            {{ form.bus_address_street.label(class="form-label") }}
                            {{ form.bus_address_street(class="form-control", placeholder="Enter your employer\'s street address") }}
                            {% if form.bus_address_street.errors %}
                                {% for error in form.bus_address_street.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            {{ form.bus_address_city.label(class="form-label") }}
                            {{ form.bus_address_city(class="form-control", placeholder="Enter city") }}
                            {% if form.bus_address_city.errors %}
                                {% for error in form.bus_address_city.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            {{ form.bus_address_state.label(class="form-label") }}
                            {{ form.bus_address_state(class="form-control", placeholder="Enter state/province") }}
                            {% if form.bus_address_state.errors %}
                                {% for error in form.bus_address_state.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ form.bus_phone_num.label(class="form-label") }}
                        {{ form.bus_phone_num(class="form-control", placeholder="Enter your employer\'s phone number") }}
                        {% if form.bus_phone_num.errors %}
                            {% for error in form.bus_phone_num.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Passport Information Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">7</div>
                    <h3>Passport Information</h3>
                </div>
                <div class="section-content">
                    <div class="mb-3">
                        <label class="form-label" for="{{ form.pass_num.id }}">{{ form.pass_num.label.text }}<span style="color: red">*</span></label>
                        {{ form.pass_num(class="form-control", placeholder="Enter passport number") }}
                        {% if form.pass_num.errors %}
                            {% for error in form.pass_num.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            Country of Issue<span style="color: red"">*</span>
                            <span 
                                class="text-primary ms-1" 
                                data-bs-toggle="tooltip" 
                                data-bs-placement="right" 
                                title="Only enter the country of issue, do NOT enter a state/province.">
                                <i class="bi bi-info-circle"></i>
                            </span>
                        </label>
                        {{ form.pass_issue_place(class="form-control", placeholder="Enter country") }}
                        {% if form.pass_issue_place.errors %}
                            {% for error in form.pass_issue_place.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label" for="{{ form.pass_iss.id }}">{{ form.pass_iss.label.text }}<span style="color: red">*</span></label>
                            {{ form.pass_iss(class="form-control", type="date") }}
                            {% if form.pass_iss.errors %}
                                {% for error in form.pass_iss.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="{{ form.pass_exp.id }}">{{ form.pass_exp.label.text }}<span style="color: red">*</span></label>
                            {{ form.pass_exp(class="form-control", type="date") }}
                            {% if form.pass_exp.errors %}
                                {% for error in form.pass_exp.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Visa Information Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">8</div>
                    <h3>Visa Information</h3>
                </div>
                <div class="section-content">
                    <div class="mb-3">
                        {{ form.visa_type.label(class="form-label") }}
                        {{ form.visa_type(class="form-select") }}
                        {% if form.visa_type.errors %}
                            {% for error in form.visa_type.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <hr class="my-4">
                    <label class="form-label">
                        <strong>Inviting Person/Organization</strong>
                        <span 
                            class="text-primary ms-1" 
                            data-bs-toggle="tooltip" 
                            data-bs-placement="right" 
                            title="If the applicant is a child, leave blank and move to the next step.">
                            <i class="bi bi-info-circle"></i>
                        </span>
                    </label>
                    <div class="mb-3">
                        <label class="form-label" for="{{ form.inviting_name.id }}">{{ form.inviting_name.label.text }}<span style="color: red">*</span></label>
                        {{ form.inviting_name(class="form-control", placeholder="Enter name") }}
                        {% if form.inviting_name.errors %}
                            {% for error in form.inviting_name.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <div class="mb-3">
                            {{ form.inviting_address_street.label(class="form-label") }}
                            {{ form.inviting_address_street(class="form-control", placeholder="Enter street address") }}
                            {% if form.inviting_address_street.errors %}
                                {% for error in form.inviting_address_street.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ form.inviting_address_city.label(class="form-label") }}
                                {{ form.inviting_address_city(class="form-control", placeholder="Enter city") }}
                                {% if form.inviting_address_city.errors %}
                                    {% for error in form.inviting_address_city.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                {{ form.inviting_address_province.label(class="form-label") }}
                                {{ form.inviting_address_province(class="form-control", placeholder="Enter state") }}
                                {% if form.inviting_address_province.errors %}
                                    {% for error in form.inviting_address_province.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Travel Information Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">9</div>
                    <h3>Travel Information</h3>
                </div>
                <div class="section-content">
                    <div class="mb-3">
                        <label class="form-label" for="{{ form.arrival_date.id }}">{{ form.arrival_date.label.text }}<span style="color: red">*</span></label>
                        {{ form.arrival_date(class="form-control", type="date") }}
                        {% if form.arrival_date.errors %}
                            {% for error in form.arrival_date.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label">
                                Departing City<span style="color: red"">*</span>
                                <span 
                                    class="text-primary ms-1" 
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="right" 
                                    title="Enter the last city you will depart from before arriving in Saudi Arabia.">
                                    <i class="bi bi-info-circle"></i>
                                </span>
                            </label>
                            {{ form.departing_city(class="form-control", placeholder="Enter departing city") }}
                            {% if form.departing_city.errors %}
                                {% for error in form.departing_city.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">
                                Arriving City<span style="color: red"">*</span>
                                <span 
                                    class="text-primary ms-1" 
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="right" 
                                    title="Enter your city of arrival in Saudi Arabia.">
                                    <i class="bi bi-info-circle"></i>
                                </span>
                            </label>
                            {{ form.arriving_city(class="form-control", placeholder="Enter arriving city") }}
                            {% if form.arriving_city.errors %}
                                {% for error in form.arriving_city.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            {{ form.airline.label(class="form-label") }}
                            {{ form.airline(class="form-control", placeholder="Enter airline name") }}
                            {% if form.airline.errors %}
                                {% for error in form.airline.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            {{ form.flight_num.label(class="form-label") }}
                            {{ form.flight_num(class="form-control", placeholder="Enter flight number") }}
                            {% if form.flight_num.errors %}
                                {% for error in form.flight_num.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        {{ form.stay_duration.label(class="form-label") }}
                        {{ form.stay_duration(class="form-control", placeholder="Enter duration of stay") }}
                        {% if form.stay_duration.errors %}
                            {% for error in form.stay_duration.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
            <!-- Purpose of Travel Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">10</div>
                    <h3>Purpose of Travel</h3>
                </div>
                <div class="section-content">
                    <div class="mb-3">
                        <label class="form-label">{{ form.purpose_of_travel.label.text }}<span style="color: red">*</span>
                            <span class="text-primary ms-1" data-bs-toggle="tooltip" data-bs-placement="right" 
                                  title="Provide specific details about your planned activities in Saudi Arabia">
                                <i class="bi bi-info-circle"></i>
                            </span>
                        </label>
                        {{ form.purpose_of_travel(class="form-control", rows="4", 
                           placeholder="Enter the detailed purpose of your visit to Saudi Arabia") }}
                        {% if form.purpose_of_travel.errors %}
                            {% for error in form.purpose_of_travel.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Emergency Contact Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">11</div>
                    <h3>Emergency Contact</h3>
                </div>
                <div class="section-content">
                    <div class="mb-3">
                        <label class="form-label">{{ form.emergency_contact_name.label.text }}<span style="color: red">*</span></label>
                        {{ form.emergency_contact_name(class="form-control", placeholder="Enter full name") }}
                        {% if form.emergency_contact_name.errors %}
                            {% for error in form.emergency_contact_name.errors %}
                                <div class="invalid-feedback d-block">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">{{ form.emergency_contact_relationship.label.text }}<span style="color: red">*</span></label>
                            {{ form.emergency_contact_relationship(class="form-control", placeholder="e.g. Spouse, Parent, Sibling") }}
                            {% if form.emergency_contact_relationship.errors %}
                                {% for error in form.emergency_contact_relationship.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">{{ form.emergency_contact_phone.label.text }}<span style="color: red">*</span></label>
                            {{ form.emergency_contact_phone(class="form-control", placeholder="Enter phone number") }}
                            {% if form.emergency_contact_phone.errors %}
                                {% for error in form.emergency_contact_phone.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Previous Visa Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">12</div>
                    <h3>Previous Visa Information</h3>
                </div>
                <div class="section-content">
                    <div class="mb-4">
                        {{ form.had_previous_visa.label(class="form-label") }}<span style="color: red">*</span>
                        <div class="radio-stack">
                            {% for subfield in form.had_previous_visa %}
                            <div class="form-check">
                                {{ subfield(class="form-check-input", onclick="togglePreviousVisa(this.value)") }}
                                {{ subfield.label(class="form-check-label") }}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div id="previousVisaFields" style="display: none;">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">{{ form.previous_visa_number.label.text }}</label>
                                {{ form.previous_visa_number(class="form-control", placeholder="Enter previous visa number") }}
                                {% if form.previous_visa_number.errors %}
                                    {% for error in form.previous_visa_number.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">{{ form.previous_visa_date.label.text }}</label>
                                {{ form.previous_visa_date(class="form-control", type="date") }}
                                {% if form.previous_visa_date.errors %}
                                    {% for error in form.previous_visa_date.errors %}
                                        <div class="invalid-feedback d-block">{{ error }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                function togglePreviousVisa(value) {
                    const previousVisaFields = document.getElementById('previousVisaFields');
                    previousVisaFields.style.display = value === 'Yes' ? 'block' : 'none';
                }
            </script>
                </div>
            </div>

            <!-- Child Applicant Section -->
            <div class="form-section mb-4">
                <div class="section-header">
                    <div class="step-number">9</div>
                    <h3>Child Applicant Information</h3>
                </div>
                <div class="section-content">
                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            {{ form.is_child.label(class="form-label") }}<span style="color: red">*</span>
                            <div class="radio-card-group">
                                {% for subfield in form.is_child %}
                                <div class="radio-card">
                                    <input type="radio" id="{{ subfield.id }}" name="{{ subfield.name }}" value="{{ subfield.data }}" {% if subfield.checked %}checked{% endif %} required onclick="toggleTravelingCompanion({{ 'true' if subfield.data == 'Yes' else 'false' }})">
                                    <label for="{{ subfield.id }}">{{ subfield.label.text }}</label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Traveling Companion Field (hidden by default) -->
                    <div class="row g-3 mb-3" id="travelingCompanionField" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">Name of Adult Traveling with the Applicant<span style="color: red">*</span></label>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    {{ form.traveling_companion_first_name(class="form-control", placeholder="First Name") }}
                                    {% if form.traveling_companion_first_name.errors %}
                                        {% for error in form.traveling_companion_first_name.errors %}
                                            <div class="invalid-feedback d-block">{{ error }}</div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.traveling_companion_middle_name(class="form-control", placeholder="Middle Name") }}
                                    {% if form.traveling_companion_middle_name.errors %}
                                        {% for error in form.traveling_companion_middle_name.errors %}
                                            <div class="invalid-feedback d-block">{{ error }}</div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    {{ form.traveling_companion_last_name(class="form-control", placeholder="Last Name") }}
                                    {% if form.traveling_companion_last_name.errors %}
                                        {% for error in form.traveling_companion_last_name.errors %}
                                            <div class="invalid-feedback d-block">{{ error }}</div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Relationship with the Applicant<span style="color: red">*</span></label>
                            {{ form.traveling_companion_relationship(class="form-control", placeholder="Enter relationship with the applicant") }}
                            {% if form.traveling_companion_relationship.errors %}
                                {% for error in form.traveling_companion_relationship.errors %}
                                    <div class="invalid-feedback d-block">{{ error }}</div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    </div>
                <script>
                    function toggleTravelingCompanion(show) {
                        const travelingCompanionField = document.getElementById('travelingCompanionField');
                        travelingCompanionField.style.display = show ? 'block' : 'none';
                    }
                </script>
            </div>
        </form>
    </div>
</div>

<div class="modal fade" id="validationModal" tabindex="-1" aria-labelledby="validationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"> 
        <h5 class="modal-title" id="validationModalLabel">Input Error</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- The custom message will be inserted here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="jobTitleModal" tabindex="-1" aria-labelledby="jobTitleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"> 
        <h5 class="modal-title" id="jobTitleModalLabel">Confirm Job Title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Please confirm that the job title you entered matches the one on your letter of invitation. Your application will be rejected if there is a discrepancy
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="jobTitleModalConfirm">Confirm</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}